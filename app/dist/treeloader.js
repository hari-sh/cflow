!function(t){"use strict";function e(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var a=e(t);function n(){return n=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n])}return t},n.apply(this,arguments)}function i(){}function s(t){if("string"==typeof t){const e=t;t=t=>t.tagName===e}const e=t;return function(){let t=Array.from(this.childNodes);return e&&(t=t.filter((t=>e(t)))),t}}const r="http://www.w3.org/2000/svg",o="http://www.w3.org/1999/xlink",l={show:o,actuate:o,href:o},d=t=>"string"==typeof t||"number"==typeof t,c=t=>1===(null==t?void 0:t.vtype);function h(t,e){let a;return"string"==typeof t&&(a=1),{vtype:a,type:t,props:e}}const p={isSvg:!1};const m={className:"class",labelFor:"for"};function u(t,e,a,n){if(e=m[e]||e,!0===a)t.setAttribute(e,"");else if(!1===a)t.removeAttribute(e);else{const i=n?l[e]:void 0;void 0!==i?t.setAttributeNS(i,e,a):t.setAttribute(e,a)}}function g(t,e){return Array.isArray(t)?t.map((t=>g(t,e))).reduce(((t,e)=>t.concat(e)),[]):f(t,e)}function f(t,e=p){if(d(t))return document.createTextNode(`${t}`);if(c(t)){let i;const{type:s,props:o}=t;if(e.isSvg||"svg"!==s||(e=Object.assign({},e,{isSvg:!0})),i=e.isSvg?document.createElementNS(r,s):document.createElement(s),function(t,e,a){for(const n in e)if("key"!==n&&"children"!==n&&"ref"!==n)if("dangerouslySetInnerHTML"===n)t.innerHTML=e[n].__html;else if("innerHTML"===n||"textContent"===n||"innerText"===n||"value"===n&&["textarea","select"].includes(t.tagName)){const a=e[n];null!=a&&(t[n]=a)}else n.startsWith("on")?t[n.toLowerCase()]=e[n]:u(t,n,e[n],a.isSvg)}(i,o,e),o.children){let t=e;e.isSvg&&"foreignObject"===s&&(t=Object.assign({},t,{isSvg:!1}));const r=g(o.children,t);null!=r&&(a=i,n=r,Array.isArray(n)||(n=[n]),(n=n.filter(Boolean)).length&&a.append(...n))}const{ref:l}=o;return"function"==typeof l&&l(i),i}var a,n;throw new Error("mount: Invalid Vnode!")}var y=".markmap-container{height:0;left:-100px;overflow:hidden;position:absolute;top:-100px;width:0}.markmap-container>.markmap-foreign{display:inline-block}.markmap-container>.markmap-foreign>div:last-child,.markmap-container>.markmap-foreign>div:last-child *{white-space:nowrap}";function v(t){const e=t.data;return Math.max(4-2*e.depth,1.5)}function x(t){t.stopPropagation()}const k=a.default.scaleOrdinal(a.default.schemeCategory10),z="undefined"!=typeof navigator&&navigator.userAgent.includes("Macintosh");class S{constructor(t,e){this.options=S.defaultOptions,this.revokers=[],this.handleZoom=t=>{const{transform:e}=t;this.g.attr("transform",e)},this.handlePan=t=>{t.preventDefault();const e=a.default.zoomTransform(this.svg.node()),n=e.translate(-t.deltaX/e.k,-t.deltaY/e.k);this.svg.call(this.zoom.transform,n)},this.handleClick=(t,e)=>{let a=this.options.toggleRecursively;(z?t.metaKey:t.ctrlKey)&&(a=!a),this.toggleNode(this.state.hashdata,e.data,a)},this.svg=t.datum?t:a.default.select(t),this.styleNode=this.svg.append("style"),this.zoom=a.default.zoom().filter((t=>this.options.scrollForPan&&"wheel"===t.type?t.ctrlKey&&!t.button:!(t.ctrlKey&&"wheel"!==t.type||t.button))).on("zoom",this.handleZoom),this.setOptions(e),this.state={id:this.options.id||this.svg.attr("id"),minX:0,maxX:0,minY:0,maxY:0},this.g=this.svg.append("g")}getStyleContent(){const{style:t}=this.options,{id:e}=this.state,a="function"==typeof t?t(e):"";return[this.options.embedGlobalCSS&&".markmap{font:300 16px/20px sans-serif}.markmap-link{fill:none}.markmap-node>circle{cursor:pointer}.markmap-foreign{display:inline-block}.markmap-foreign a{color:#0097e6}.markmap-foreign a:hover{color:#00a8ff}.markmap-foreign code{background-color:#f0f0f0;border-radius:2px;color:#555;font-size:calc(1em - 2px);padding:.25em}.markmap-foreign pre{margin:0}.markmap-foreign pre>code{display:block}.markmap-foreign del{text-decoration:line-through}.markmap-foreign em{font-style:italic}.markmap-foreign strong{font-weight:700}.markmap-foreign mark{background:#ffeaa7}",a].filter(Boolean).join("\n")}updateStyle(){this.svg.attr("class",function(t,...e){const a=(t||"").split(" ").filter(Boolean);return e.forEach((t=>{t&&a.indexOf(t)<0&&a.push(t)})),a.join(" ")}(this.svg.attr("class"),"markmap",this.state.id));const t=this.getStyleContent();this.styleNode.text(t)}toggleNode(t,e){var a,i=null!=(a=e.payload)&&a.fold?0:1;i||e.hasChild||(e.hasChild=!0,e.content in t&&t[e.content].children?.length>0&&(e.children=[],t[e.content].children.forEach((t=>{var a={content:t.content,children:[{content:"N",isNull:!0}],payload:{fold:1}};e.children.push(a)}))),this.initializeDataArr(e)),e.payload=n({},e.payload,{fold:i}),this.renderData(e)}initdom(){const{id:t}=this.state,e=f(h("div",{className:`markmap-container markmap ${t}-g`})),a=f(h("style",{children:[this.getStyleContent(),y].join("\n")}));this.container=e,document.body.append(e,a)}getgrp(t){return f(h("div",{className:"markmap-foreign",style:"",children:h("div",{dangerouslySetInnerHTML:{__html:t}})}))}initializeDataNode(t){const{color:e,nodeMinHeight:a}=this.options,i=this.getgrp(t.content);this.container.append(i),t.state=n({},t.state,{id:1,el:i.firstChild}),t.state.path="1";const s=t.state,r=s.el.getBoundingClientRect();t.content=s.el.innerHTML,s.size=[Math.ceil(r.width)+1,Math.max(Math.ceil(r.height),a)],s.key=s.id+t.content,e(t)}initializeDataArr(t){const{color:e,nodeMinHeight:a}=this.options;t.children.forEach(((i,s,r)=>{const o=this.getgrp(i.content);this.container.append(o),i.state=n({},i.state,{id:s+1,el:o.firstChild}),i.state.path=[t.state.path,i.state.id].join(".");const l=i.state,d=l.el.getBoundingClientRect();i.content=l.el.innerHTML,l.size=[Math.ceil(d.width)+1,Math.max(Math.ceil(d.height),a)],l.key=i.state.path+i.content,e(i)}))}setOptions(t){this.options=n({},this.options,t),this.options.zoom?this.svg.call(this.zoom):this.svg.on(".zoom",null),this.options.pan?this.svg.on("wheel",this.handlePan):this.svg.on("wheel",null)}setDataHash(t,e,a){e&&(this.state.data={content:e,children:[{content:"NULL",isNull:!0}],payload:{fold:1}}),t&&(this.state.hashdata=t),this.state.ishashmap=a,this.initdom(),this.initializeDataNode(this.state.data),this.updateStyle(),this.renderData(this.state.data)}setDatanHash(t,e){t&&(this.state.data=t),this.state.ishashmap=e,this.initdom(),this.setAllNodesnHash(this.state.data),this.updateStyle(),this.renderData(this.state.data)}setAllNodesnHash(t){this.initializeDataNode(t);for(var e=[t];e?.length>0;){const t=e.pop();t.children?.length>0&&this.initializeDataArr(t),t.children?.forEach((t=>e.push(t)))}}renderData(t){var e,n;if(!this.state.data)return;const{spacingHorizontal:i,paddingX:r,spacingVertical:o,autoFit:l,color:d}=this.options,c=a.default.flextree({}).children((t=>{var e;if(null==(e=t.payload)||!e.fold)return t.children})).nodeSize((t=>{const[e,a]=t.data.state.size;return[a,e+(e?2*r:0)+i]})).spacing(((t,e)=>t.parent===e.parent?o:2*o)),h=c.hierarchy(this.state.data);c(h);const p=h.descendants().reverse(),m=h.links(),u=a.default.linkHorizontal(),g=a.default.min(p,(t=>t.x-t.xSize/2)),f=a.default.max(p,(t=>t.x+t.xSize/2)),y=a.default.min(p,(t=>t.y)),k=a.default.max(p,(t=>t.y+t.ySize-i));Object.assign(this.state,{minX:g,maxX:f,minY:y,maxY:k}),l&&this.fit();const z=t&&p.find((e=>e.data===t))||h,S=null!=(e=z.data.state.x0)?e:z.x,w=null!=(n=z.data.state.y0)?n:z.y,b=this.g.selectAll(s("g")).data(p,(t=>t.data.state.key)),N=b.enter().append("g").attr("data-depth",(t=>t.data.depth)).attr("data-path",(t=>t.data.state.path)).attr("transform",(t=>`translate(${w+z.ySize-t.ySize},${S+z.xSize/2-t.xSize})`)),C=this.transition(b.exit());C.select("line").attr("x1",(t=>t.ySize-i)).attr("x2",(t=>t.ySize-i)),C.select("foreignObject").style("opacity",0),C.attr("transform",(t=>`translate(${z.y+z.ySize-t.ySize},${z.x+z.xSize/2-t.xSize})`)).remove();const j=b.merge(N).attr("class",(t=>{var e;return["markmap-node",(null==(e=t.data.payload)?void 0:e.fold)&&"markmap-fold"].filter(Boolean).join(" ")}));this.transition(j).attr("transform",(t=>`translate(${t.y},${t.x-t.xSize/2})`));const E=j.selectAll(s("line")).data((t=>[t]),(t=>t.data.state.key)).join((t=>t.append("line").attr("x1",(t=>t.ySize-i)).attr("x2",(t=>t.ySize-i))),(t=>t),(t=>t.remove()));this.transition(E).attr("x1",-1).attr("x2",(t=>t.ySize-i+2)).attr("y1",(t=>t.xSize)).attr("y2",(t=>t.xSize)).attr("stroke",(t=>d(t.data))).attr("stroke-width",v);const L=j.selectAll(s("circle")).data((t=>{var e;return null!=(e=t.data.children)&&e.length?[t]:[]}),(t=>t.data.state.key)).join((t=>t.append("circle").attr("stroke-width","1.5").attr("cx",(t=>t.ySize-i)).attr("cy",(t=>t.xSize)).attr("r",0).on("click",((t,e)=>this.handleClick(t,e))).on("mousedown",x)),(t=>t),(t=>t.remove()));this.transition(L).attr("r",6).attr("cx",(t=>t.ySize-i)).attr("cy",(t=>t.xSize)).attr("stroke",(t=>d(t.data))).attr("fill",(t=>{var e;return null!=(e=t.data.payload)&&e.fold&&t.data.children?d(t.data):"#fff"}));const M=j.selectAll(s("ground")).data((t=>!0===t.data.isNull?[t]:[]),(t=>t.data.state.key)).join((t=>t.append("circle").attr("stroke-width","3").attr("cx",(t=>t.ySize-i)).attr("cy",(t=>t.xSize)).attr("r",0)),(t=>t),(t=>t.remove()));this.transition(M).attr("r",3).attr("cx",(t=>t.ySize-i)).attr("cy",(t=>t.xSize)).attr("stroke",(t=>d(t.data))).attr("fill",(t=>{var e;return null!=(e=t.data.payload)&&e.fold&&t.data.children?d(t.data):"#fff"}));const H=this.g.selectAll(s("path")).data(m,(t=>t.target.data.state.key)).join((t=>{const e=[w+z.ySize-i,S+z.xSize/2];return t.insert("path","g").attr("class","markmap-link").attr("data-depth",(t=>t.target.data.depth)).attr("data-path",(t=>t.target.data.state.path)).attr("d",u({source:e,target:e}))}),(t=>t),(t=>{const e=[z.y+z.ySize-i,z.x+z.xSize/2];return this.transition(t).attr("d",u({source:e,target:e})).remove()}));this.transition(H).attr("stroke",(t=>d(t.target.data))).attr("stroke-width",(t=>v(t.target))).attr("d",(t=>{const e=t.source,a=t.target,n=[e.y+e.ySize-i,e.x+e.xSize/2],s=[a.y,a.x+a.xSize/2];return u({source:n,target:s})}));const A=j.selectAll(s("foreignObject")).data((t=>[t]),(t=>t.data.state.key)).join((t=>{const e=t.append("foreignObject").attr("class","markmap-foreign").attr("x",r).attr("y",0).style("opacity",0).on("mousedown",x).on("dblclick",x);return e.append("xhtml:div").select((function(t){let e=t.data.state.el.cloneNode(!0);return this.replaceWith(e),e})).attr("xmlns","http://www.w3.org/1999/xhtml"),e}),(t=>t),(t=>t.remove())).attr("width",(t=>t.data.isNull?1:Math.max(0,t.ySize-i-2*r))).attr("height",(t=>t.xSize));this.transition(A).style("opacity",1),p.forEach((t=>{t.data.state.x0=t.x,t.data.state.y0=t.y}))}transition(t){const{duration:e}=this.options;return t.transition().duration(e)}async fit(){const t=this.svg.node(),{width:e,height:n}=t.getBoundingClientRect(),{fitRatio:s}=this.options,{minX:r,maxX:o,minY:l,maxY:d}=this.state,c=d-l,h=o-r,p=Math.min(e/c*s,n/h*s,2),m=a.default.zoomIdentity.translate(50,(n-h*p)/2-r*p).scale(p);return this.transition(this.svg).call(this.zoom.transform,m).end().catch(i)}destroy(){this.svg.on(".zoom",null),this.svg.html(null),this.revokers.forEach((t=>{t()}))}static create(t,e,a=null,n){const i=new S(t,null);return n?i.setDataHash(e,a,n):i.setDatanHash(e,n),i.fit(),i}}S.defaultOptions={autoFit:!1,color:t=>{var e;return k(`${(null==(e=t.state)?void 0:e.path)||""}`)},duration:500,embedGlobalCSS:!0,fitRatio:.95,maxWidth:0,nodeMinHeight:16,paddingX:8,scrollForPan:z,spacingHorizontal:80,spacingVertical:5,initialExpandLevel:-1,zoom:!0,pan:!0,toggleRecursively:!1};var w=S;let b=null;const N=(t,e,a)=>{const n=e.value;e.value="",b?.destroy(),b=w.create("svg#mindmap",t,n,a)};if(ishashmap){const t=document.createElement("div");t.className="container",t.id="inputcont";const e=document.createElement("form"),a=document.createElement("input");a.id="diaginput",a.type="text",a.placeholder="Search...";const n=document.createElement("button");n.id="diagbtn",n.type="button",n.textContent="Search";const i=document.createElement("div");i.id="suggestul",i.className="suggestions",document.body.appendChild(t),t.appendChild(e),e.appendChild(a),e.appendChild(n),e.appendChild(i);const s=document.createElement("ul");i.appendChild(s);const r=(t=>{for(var e={},a=[t];a?.length>0;){const t=a.pop();t.children?.length>0&&(e[t.content]=t),t.children?.forEach((t=>a.push(t)))}return e})(datajson),o=Object.keys(r);t.style.display="flex",a.addEventListener("keypress",(t=>{"Enter"===t.key&&(t.preventDefault(),N(r,a,ishashmap))})),a.addEventListener("keyup",(t=>function(t,e,a){const n=t.currentTarget.value;var i=[];if(n.length>0){const t=n.toLowerCase();for(let a=0;a<e.length;a++)e[a].toLowerCase().indexOf(t)>-1&&i.push(e[a])}if(a.innerHTML="",i.length>0){for(let t=0;t<i.length;t++){let e=i[t];const s=e.match(new RegExp(n,"i"));e=e.replace(s[0],`<strong>${s[0]}</strong>`),a.innerHTML+=`<li>${e}</li>`}a.classList.add("has-suggestions")}else i=[],a.innerHTML="",a.classList.remove("has-suggestions")}(t,o,i))),n.addEventListener("click",(()=>N(r,a,ishashmap))),i.addEventListener("click",(t=>function(t,e,a,n,i){a.value=t.target.innerText,a.focus(),i.innerHTML="",i.classList.remove("has-suggestions"),N(e,a,n)}(t,r,a,ishashmap,i)))}else C=datajson,j=ishashmap,b?.destroy(),b=w.create("svg#mindmap",C,null,j);var C,j}(d3);
