<!DOCTYPE html>
  <html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Markmap</title>
    <link rel="stylesheet" href="../inc/treeview.css">
  </head>
  
  <body>
    <div class="container">
        <form>
        <input id="diaginput" type="text" placeholder="Search...">
        <button id="diagbtn" type="button">Search</button>
        </form>
    </div>
    <svg id="mindmap"></svg>
    <script src="../inc/d3.js"></script>
    <script src="../inc/d3-flextree.js"></script>
    <script src="../inc/treeview.js"></script>
    <script>
    const datajson = 
{
  "content": "sample",
  "children": [
    {
      "content": "a",
      "children": [
        {
          "content": "b",
          "children": [
            {
              "content": "c"
            }
          ]
        },
        {
          "content": "d",
          "children": [
            {
              "content": "e"
            },
            {
              "content": "x",
              "children": [
                {
                  "content": "n"
                }
              ]
            },
            {
              "content": "g"
            }
          ]
        },
        {
          "content": "h",
          "children": [
            {
              "content": "i",
              "children": [
                {
                  "content": "d"
                }
              ]
            },
            {
              "content": "b"
            }
          ]
        },
        {
          "content": "m"
        }
      ]
    }
  ]
}
    </script>
    <script>
      const makeDataObj = (dobj) => {
        var dataObj = {};
        var stack = [dobj];
        while (stack?.length > 0){
          const curnObj = stack.pop();
          if(curnObj.children?.length > 0){
            dataObj[curnObj.content] = curnObj;
          }
          curnObj.children?.forEach(cobj => stack.push(cobj));
        }
        return dataObj;
      }
      const loadTreeData = (hashdata) => {
        const diagstr = document.getElementById('diaginput').value;
        document.getElementById('diaginput').value = "";
        window.mm?.destroy();
        window.mm = window.markmap.Markmap.create('svg#mindmap', hashdata, diagstr);
      }
    </script>
    <script>
      const hashdata = makeDataObj(datajson);
      document.getElementById("diagbtn").addEventListener("click", loadTreeData);
      document.getElementById('diaginput').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
          e.preventDefault()
          loadTreeData(hashdata);
        }
      });
    </script>
  </body>
</html>
